<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Consensus Compare: Casper vs. Tendermint</title><meta name="description" content="The Long Road to Proof-of-Stake"><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Consensus Compare: Casper vs. Tendermint</h1>
</header>
<section data-field="subtitle" class="p-summary">
The Long Road to Proof-of-Stake
</section>
<section data-field="body" class="e-content">
<section name="5126" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="761a" id="761a" class="graf graf--h3 graf--leading graf--title">Consensus Compare: Casper vs. Tendermint</h3></div><div class="section-inner sectionLayout--outsetColumn"><figure name="eb34" id="eb34" class="graf graf--figure graf--layoutOutsetCenter graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1000px; max-height: 563px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.3%;"></div><img class="graf-image" data-image-id="1*M-mVmIzJrdSb59R-Z7W98Q.jpeg" data-width="3840" data-height="2160" src="https://cdn-images-1.medium.com/max/1000/1*M-mVmIzJrdSb59R-Z7W98Q.jpeg"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="9a9b" id="9a9b" class="graf graf--h3 graf-after--figure">The Long Road to Proof-of-Stake</h3><p name="cac8" id="cac8" class="graf graf--p graf-after--h3">For definitions, see (<a href="https://blog.cosmos.network/understanding-the-basics-of-a-proof-of-stake-security-model-de3b3e160710" data-href="https://blog.cosmos.network/understanding-the-basics-of-a-proof-of-stake-security-model-de3b3e160710" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Primer</a>).</p><p name="6868" id="6868" class="graf graf--p graf-after--p">The Byzantine General’s Problem was <a href="http://lamport.azurewebsites.net/pubs/pubs.html#sift" data-href="http://lamport.azurewebsites.net/pubs/pubs.html#sift" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">first proposed by SIFT</a> in the 1970s to tolerate real-time faults in commercial aircraft and then given the name by Lamport, Shostak, and Pease in 1982. It described the problem of achieving distributed agreement over a compromised communications network — of making “a reliable system from unreliable parts”, as Ethan Buchman of Cosmos puts it. From 1982 to 1999, no one had invented a system that solved the Byzantine General’s Problem. It was irrelevant to computing for a long time because, at the time, the internet had evolved out of cloud-based central computing; all that was needed was fault-tolerance.</p><p name="9d1d" id="9d1d" class="graf graf--p graf-after--p">So, crash-fault tolerant algorithms like Paxos, <a href="http://lamport.azurewebsites.net/pubs/pubs.html#lamport-paxos" data-href="http://lamport.azurewebsites.net/pubs/pubs.html#lamport-paxos" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">invented in the late 1980s</a>, and Raft, invented in 2013, were widely deployed. Practical Byzantine Fault Tolerance (PBFT) was created in 1999, but was not really adopted by anyone outside of academia. The breakthrough that Satoshi Nakamoto made in 2008 was in bringing internet-scale distributed Byzantine Fault Tolerant (BFT)consensus into a blockchain scheme. Once that demonstration happened, a lot of the people from the systems research community started to formulate ideas around applying what was largely an academic curiosity to a real-world application.</p><p name="4b5b" id="4b5b" class="graf graf--p graf-after--p">In 2011, <a href="https://bitcointalk.org/index.php?topic=27787.0" data-href="https://bitcointalk.org/index.php?topic=27787.0" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">a thread in the BitcoinTalk forum</a> formed discussions around the idea of something called Proof-of-Stake. First-generation PoS protocols such as Peercoin were naively implemented but were steps in the right direction. The first person who really started talking about applying BFT research in a PoS public blockchain context was Jae Kwon, who, in 2014, invented Tendermint.</p><p name="9f13" id="9f13" class="graf graf--p graf-after--p">At the time, PoS research made a large assumption that the set of peers in the system is static and that it would be stable over long periods of time. It was completely unrealistic in the blockchain environment. Jae Kwon’s major breakthrough that enabled Tendermint was in adapting BFT research to the domain of replicated state machines (blockchains), using blocks, hash-linking, dynamic validator sets, and rotating leader election.</p><p name="857e" id="857e" class="graf graf--p graf-after--p">In the post-Tendermint environment, a huge number of different consensus algorithms (Honeybadger, Ouroboros, Tezos, Casper) popped up that all incorporate elements of BFT research along with other modular observations on the blockchain.</p><p name="4209" id="4209" class="graf graf--p graf-after--p">The keystone problem that all this research that’s been done in Proof-of-Stake forms around the question: Can we achieve the same level of security as a Proof-of-Work (PoW) system like Bitcoin while not depleting physical scarce resources to do it? Proof-of-Stake (PoS), i.e., when voting power is denominated in a native currency rather than hashpower, has been the leading class of research attempting to answer this question. Widely debated problems in blockchain over scalability, high overhead costs of running PoW miners, and environmental externalities all motivate the pouring of considerable resources into PoS security research.</p><p name="30d5" id="30d5" class="graf graf--p graf-after--p">This article explores the unique approaches to Proof-of-Stake powering three of the major PoS protocols in the cryptocurrency space: Casper the Friendly Ghost, research led by Vlad Zamfir, Casper the Friendly Finality Gadget, research led by Vitalik Buterin, and <a href="https://github.com/tendermint/tendermint.github.io/blob/5c111743a03d2c6ed2e0b14bd3091cac8974c8da/docs/tendermint_v02.pdf" data-href="https://github.com/tendermint/tendermint.github.io/blob/5c111743a03d2c6ed2e0b14bd3091cac8974c8da/docs/tendermint_v02.pdf" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Tendermint</a>, led by Jae Kwon.</p><h3 name="71db" id="71db" class="graf graf--h3 graf-after--p">Pitfalls of Proof-of-Stake</h3><h4 name="c0bb" id="c0bb" class="graf graf--h4 graf-after--h3">Nothing-at-Stake</h4><p name="04c6" id="04c6" class="graf graf--p graf-after--h4">At first, this problem was explored under a variety of phrases to describe the general pitfalls of Proof-of-Stake. Jae Kwon <a href="https://github.com/tendermint/tendermint.github.io/blob/5c111743a03d2c6ed2e0b14bd3091cac8974c8da/docs/tendermint_v02.pdf" data-href="https://github.com/tendermint/tendermint.github.io/blob/5c111743a03d2c6ed2e0b14bd3091cac8974c8da/docs/tendermint_v02.pdf" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">first referred to this problem</a> in May 2014 under the unfortunate name of “the fallacy of false choices”. Vitalik, in July 2014, popularized the now well-defined problem described by Bitcoin developers as “nothing-at-stake”. The problem presents this scenario: validators can effectively break safety by voting for multiple conflicting blocks at a given block height without incurring cost for doing so.</p><p name="21be" id="21be" class="graf graf--p graf-after--p">Naive PoS implementations are vulnerable to these attacks. Catastrophically, since there’s no incentive to ever converge on a unique chain and every incentive to sign duplicitously on multiple conflicting chains at once, the economically optimal strategy becomes voting on as many forks as you can find in order to reap more block rewards. The following diagram demonstrates this.</p><figure name="9c39" id="9c39" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 417px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 59.599999999999994%;"></div><img class="graf-image" data-image-id="0*_BcnnCXeGxubVh2F." data-width="1189" data-height="709" src="https://cdn-images-1.medium.com/max/800/0*_BcnnCXeGxubVh2F."></div><figcaption class="imageCaption">Expected value for voting on competing chains is greater than expected value for voting on a single chain in naive PoS design.</figcaption></figure><p name="66f9" id="66f9" class="graf graf--p graf-after--figure">In Proof-of-Work, the “penalty” for mining on multiple chains is that a miner must split up their physical hashing power (scarce resource) to do this. In modern, non-degenerate PoS design, this cost must be baked into the protocol to mimic physical PoW mining constraints.</p><p name="fa7e" id="fa7e" class="graf graf--p graf-after--p">This attack vector is mitigated with the broadly conceived notion of a ‘<a href="https://blog.ethereum.org/2014/01/15/slasher-a-punitive-proof-of-stake-algorithm/" data-href="https://blog.ethereum.org/2014/01/15/slasher-a-punitive-proof-of-stake-algorithm/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">slasher</a>’, or in-protocol penalty, introduced by Vitalik Buterin in January 2014. Jae Kwon <a href="https://tendermint.com/static/docs/tendermint.pdf" data-href="https://tendermint.com/static/docs/tendermint.pdf" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">extrapolated this approach further</a> the same year, a development which materialized into the first iteration of the Tendermint consensus protocol. Slashing, and the conditions that warrant such punishment, is instrumental to all non-degenerate BFT protocols, so much so that it is employed in all three of the consensus protocols presented in this article.</p><h4 name="215d" id="215d" class="graf graf--h4 graf-after--p">Long Range Attacks</h4><p name="f2a4" id="f2a4" class="graf graf--p graf-after--h4">The long range attack draws from the right that users have to withdraw their security deposits. A fundamental problem arises with this because it means an attacker can build up a fork from an arbitrarily long range without fear of being slashed. Once security deposits are unbonded, the incentive not to vote on a long-range fork from some block height ago is removed. In other words, when more than ⅔ of the validators have unbonded, they could maliciously create a second chain which included the past validator set, which could result in arbitrary alternative transactions.</p><p name="b8c6" id="b8c6" class="graf graf--p graf-after--p">This could be fatal for Proof-of-Stake protocols because the security model is necessarily ‘subjective’. A security model is said to be ‘subjective’ when participation in a network requires large amounts of social information, where new nodes coming onto the network can arrive at different conclusions about the current network state because their decision is based off of subjective information, i.e., social reputation. In contrast, a Proof-of-Work security model is necessarily ‘objective’ because a current network state will always be the state with the most amount of proof of work, and new nodes will arrive at the same conclusion since their decision is based off of objective information.</p><p name="937b" id="937b" class="graf graf--p graf-after--p">Long range attacks in PoS are rectified under the <a href="https://blog.ethereum.org/2014/11/25/proof-stake-learned-love-weak-subjectivity/" data-href="https://blog.ethereum.org/2014/11/25/proof-stake-learned-love-weak-subjectivity/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">weak subjectivity</a> model, which requires the following of new nodes which come onto the network:</p><ul class="postList"><li name="1fa7" id="1fa7" class="graf graf--li graf-after--p"><em class="markup--em markup--li-em">Must be currently bonded</em>. Only trust validating nodes that <em class="markup--em markup--li-em">currently</em> have security deposits.</li><li name="6ede" id="6ede" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">Unbonded deposits must go through a ‘thawing’ period</em>. After unbonding, tokens need time to ‘thaw’ for weeks to months to account for synchrony assumptions (i.e. delayed messages).</li><li name="9b41" id="9b41" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">Forbid reverting back before N blocks, where N is the length of the security deposit</em>. This rule invalidates any long range fork.</li><li name="0339" id="0339" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">Optionally store the validator set on a PoW chain</em>.</li></ul><figure name="2875" id="2875" class="graf graf--figure graf--layoutOutsetLeft graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 525px; max-height: 554px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 105.60000000000001%;"></div><img class="graf-image" data-image-id="0*FBKX_yWkn7j8x8ZS." data-width="790" data-height="834" src="https://cdn-images-1.medium.com/max/600/0*FBKX_yWkn7j8x8ZS."></div><figcaption class="imageCaption">Illustration: Long range attack. Source: <em class="markup--em markup--figure-em">Casper the Friendly Finality Gadget</em></figcaption></figure><p name="2f06" id="2f06" class="graf graf--p graf-after--figure">Casper(s) and Tendermint adopt a simple locking mechanism (colloquially called ‘freezing’ in Tendermint) which “locks” stake for a certain period of time (weeks to months of ‘thawing’) in order to prevent any malicious coalition of validators from violating safety. In Casper the Friendly Finality Gadget (CFFG), a fork choice rule to never revert a finalized block prevents the long range attack. By using timestamps, long range forks in CFFG attempting to revise blocks older than a finalized block are ignored by the protocol.</p><h4 name="0a46" id="0a46" class="graf graf--h4 graf-after--p">Cartel Formation</h4><p name="93eb" id="93eb" class="graf graf--p graf-after--h4">A third, final hurdle facing any economic paradigm that’s worth any value faces the very real problem of oligopolies; decentralized protocols with native cryptocurrencies are no exception.</p><p name="8db9" id="8db9" class="graf graf--p graf--startsWithDoubleQuote graf-after--p"><em class="markup--em markup--p-em">“Cryptocurrency is incredibly concentrated. So is mining power. Oligopolistic competition is the norm in many ‘real-life’ markets. Coordination between a small number of relatively wealthy validators is much easier than coordination between a large number of relatively poor validators. Cartel formation is completely expected, in our context.”</em></p><p name="ee25" id="ee25" class="graf graf--p graf-after--p">— Vlad Zamfir, <a href="https://medium.com/@Vlad_Zamfir/the-history-of-casper-chapter-4-3855638b5f0e" data-href="https://medium.com/@Vlad_Zamfir/the-history-of-casper-chapter-4-3855638b5f0e" class="markup--anchor markup--p-anchor" target="_blank"><em class="markup--em markup--p-em">The History of Casper Chapter 4</em></a></p><p name="1eac" id="1eac" class="graf graf--p graf-after--p">Tendermint relies on extra-protocol governance measures to combat oligopolistic validators. While there are no in-protocol measures for censorship-resistance, the rationale behind relying on out-of-band social information to tackle cartel formation is that the users would <em class="markup--em markup--p-em">eventually</em> and <em class="markup--em markup--p-em">inevitably</em> notice cartels forming, socially gossip about it, and then either abandon or vote to reorganize the blockchain that’s under attack.</p><p name="8ae9" id="8ae9" class="graf graf--p graf-after--p graf--trailing">Thus far, Vlad’s construction of the Casper protocol is the only model which explicitly combats cartel formation with in-consensus censorship-resistant incentives.</p></div></div></section><section name="4167" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="5625" id="5625" class="graf graf--h3 graf--leading">Broad Overview</h3><p name="0771" id="0771" class="graf graf--p graf-after--h3">There are varying ways to implement Proof-of-Stake algorithms, but the two major tenets in Proof-of-Stake design are chain-based PoS and Byzantine Fault Tolerant-based PoS. Tendermint is a BFT-based PoS design, Casper the Friendly Ghost is a chain-based PoS design, and Casper the Friendly Finality Gadget is a hybrid of the two.</p><p name="02be" id="02be" class="graf graf--p graf-after--p">The <a href="https://en.wikipedia.org/wiki/CAP_theorem" data-href="https://en.wikipedia.org/wiki/CAP_theorem" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">CAP Theorem</a> in computer science returns the impossibility of providing more than 2 out of 3 guarantees in distributed data systems: availability, consistency, and partition tolerance. Chain-based PoS algorithms tend to choose availability over consistency, where having availability means that all transactions will be processed, but at the expense of a consistent state replicating across the network. BFT-based PoS algorithms, on the other hand, strictly choose consistency over availability.</p><h3 name="4887" id="4887" class="graf graf--h3 graf-after--p">Byzantine Fault Tolerant-based Proof-of-Stake</h3><p name="3630" id="3630" class="graf graf--p graf-after--h3">Byzantine Fault Tolerant (BFT) consensus algorithms stem from a rich body of research spanning more than 30 years. Tendermint (2014) is the first adaptation of Proof-of-Stake consensus derived from the Practical Byzantine Fault Tolerant (PBFT) algorithm introduced by Castro and Liskov in 1999. BFT-based PoS protocols pseudo-randomly assign a validator the right to propose new blocks during a multi-round voting process. However, committing and finalizing blocks depends on a supermajority — a &gt;⅔ quorum — of all validators signing off on the proposed block. This may take several rounds, or polkas, before blocks become finalized. BFT systems can only tolerate up to a ⅓ of failures, where failures can include arbitrary or malicious behaviour.</p><h4 name="7d5b" id="7d5b" class="graf graf--h4 graf-after--p"><strong class="markup--strong markup--h4-strong">Tendermint Core</strong></h4><p name="0cb3" id="0cb3" class="graf graf--p graf-after--h4">Tendermint consists of two chief technical components: a blockchain consensus engine and a generic application interface. The consensus engine, called Tendermint Core, ensures that the same transactions are recorded on every machine in the same order. The application interface, called the <a href="https://github.com/tendermint/abci" data-href="https://github.com/tendermint/abci" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Application Blockchain Interface (ABCI)</a>, enables the transactions to be processed in any programming language.</p><p name="136c" id="136c" class="graf graf--p graf-after--p">At the core, Tendermint works as a round-based voting mechanism which makes the consensus protocol. A round is broken up into a three-step process through which validators propose blocks, signal commitment intent and then sign to commit new blocks. This mechanism yields a secure state replication machine for atomic broadcast with an added layer of accountability — safety faults are perfectly attributable in Tendermint.</p><p name="7b99" id="7b99" class="graf graf--p graf-after--p">Tendermint consensus algorithm begins with a set of validators. Validators maintain a full copy of the blockchain and are identified by their public keys. They take turns proposing blocks at each new block height. There is at most one proposer per voting round. Each proposal is signed by a validator’s corresponding private key so that the validator responsible for it can be identified if some failure were to occur. The rest of the validators then vote on each proposal, signing their votes with their private keys. This constitutes a single round. But it may take several rounds before a new block is committed due to network asynchrony.</p><figure name="f82f" id="f82f" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 421px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 60.199999999999996%;"></div><img class="graf-image" data-image-id="1*GE_R8CGb3p60iMKzJzp9OQ.png" data-width="1000" data-height="602" src="https://cdn-images-1.medium.com/max/800/1*GE_R8CGb3p60iMKzJzp9OQ.png"></div><figcaption class="imageCaption">A voting round depicting a circuit of partially synchronous proposals, followed by asynchronous voting. After the proposal step, validators only make progress after hearing from ⅔ or more of the other validators. The dotted arrow extends the consensus into atomic broadcast by moving to the next height.</figcaption></figure><p name="9185" id="9185" class="graf graf--p graf-after--figure">Validators may fail to commit a block for a number of arbitrary reasons; i.e., the current proposer may be offline, or a network may be experiencing latency. Tendermint allows a validator to be skipped. Validators wait a small amount of time to receive a complete proposal block from the proposer before voting to move to the next round. This reliance on a timeout is what makes Tendermint a weakly synchronous protocol, rather than an asynchronous one. However, the rest of the protocol is asynchronous, and validators only make progress after hearing from more than ⅔ of the validator set. As such, Tendermint requires 100% uptime from a supermajority of its validators because if ⅓ or more are offline or partitioned, the network may halt.</p><p name="4373" id="4373" class="graf graf--p graf-after--p">Assuming less than ⅓ of the validators are Byzantine, Tendermint guarantees that safety will never be violated — that is, validators will never commit conflicting blocks at the same height. Therefore, a Tendermint-based blockchain never forks.</p><p name="d08c" id="d08c" class="graf graf--p graf-after--p">The design decision behind Tendermint so far really prioritizes safety and finality over liveness. There’s a fairly high likelihood that in the real world, the system will actually halt, and the participants will have to organize outside of the protocol in some sort of software update to restart the system.</p><p name="842b" id="842b" class="graf graf--p graf-after--p">Tendermint formed the basis for Casper research when very few people in the cryptocurrency community understood what the insight was and why it was valuable. The insight was: If the chain itself is highly fault-tolerant, then you can rely on the chain to make good decisions about who can produce blocks. If the chain itself is less reliable, then you end up with this chicken and the egg problem, which is what doomed every other consensus algorithm that came before.</p><p name="42cc" id="42cc" class="graf graf--p graf-after--p">This design decision is perceived as inferior to availability-prioritizing protocols like Ethereum and Bitcoin. The trade-off in Bitcoin is: If its network goes split brain, Bitcoin loses all of its safety guarantees in various attack scenarios. It’s the overall theme of finality, which is the idea that if your confidence interval is less than 100%, that the chain you’re following is the correct chain, and you’re using that chain to select who is going to produce the next block, then once you’ve diverted to an unsafe chain, there’s no clear path back to the correct chain.</p><p name="f0a4" id="f0a4" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Properties at a Glance</strong></p><ul class="postList"><li name="6f59" id="6f59" class="graf graf--li graf-after--p"><em class="markup--em markup--li-em">Provable liveness in partially synchronous network</em>.</li><li name="2c1b" id="2c1b" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">Safety threshold: ⅓ of validators.</em></li><li name="53d0" id="53d0" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">Public/private chain compatible.</em></li><li name="c621" id="c621" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">Instant finality: 1–3 seconds depending on number of validators.</em></li><li name="55ed" id="55ed" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">Consistency-prioritizing.</em></li><li name="1760" id="1760" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">Consensus safety.</em></li></ul><h3 name="b197" id="b197" class="graf graf--h3 graf-after--li">Chain-based Proof-of-Stake</h3><p name="875b" id="875b" class="graf graf--p graf-after--h3">Chain-based Proof-of-Stake simulates Proof-of-Work consensus, in that the protocol assigns the right to commit a single new block to a pseudorandomly-selected validator, where the new block is hash-linked to a parent block of the previously longest chain. Chain-based PoS relies largely on synchronous networks, generally prioritizing availability over consistency. Casper(s) is an adaptation of the core ideas of Tendermint to a setting that prefers liveness over safety.</p><h4 name="95f9" id="95f9" class="graf graf--h4 graf-after--p"><strong class="markup--strong markup--h4-strong">Casper the Friendly Finality Gadget</strong></h4><p name="1784" id="1784" class="graf graf--p graf-after--h4">While Casper the Friendly Ghost is an explicit PoS construct, Casper the Friendly Finality Gadget (CFFG) is a PoS overlay on top of the existing Ethereum PoW proposal mechanism — a hybrid PoW/PoS implementation led by Vitalik Buterin.</p><p name="b169" id="b169" class="graf graf--p graf-after--p">Neither Bitcoin nor Ethereum’s PoW consensus protocols make ‘final’ decisions, and blocks can potentially be reorganized to some past block height. A block is said to be ‘final’ when there is no chance of it being revised. Since Proof-of-Work provides no such revision guarantees, it is not actually considered to be consensus safe. Instead, blocks get <em class="markup--em markup--p-em">probabilistically</em> more finalized as we move deeper into the chain. In order to add the desired properties of finality and 51% attack resistance to the Ethereum blockchain, implementing CFFG logic would ideally provide this effect.</p><p name="7b22" id="7b22" class="graf graf--p graf-after--p">Casper the Friendly Finality Gadget will be rolled out in multiple steps to conservatively transition Ethereum’s PoW security model to a wholly PoS one over time. The first iteration of Casper will be implemented as the hybrid PoW/PoS protocol discussed here. The final iteration of Casper will likely take the lessons from both CFFG and CTFG toward a complete PoS protocol.</p><p name="de96" id="de96" class="graf graf--p graf-after--p">CFFG is a hybrid between chain-based PoS and Byzantine Fault Tolerant-based PoS, as it borrows from both schools of thought. Its modular overlay design makes upgrading the existing PoW chain easier, as it is a more conservative approach to upgrading the system to an entirely different consensus model.</p><p name="9b7a" id="9b7a" class="graf graf--p graf-after--p">Casper’s application logic lives inside a smart contract. To become a validator in Casper, one must hold ether (ETH) and deposit some ETH to be leveraged as stake into the Casper smart contract. The block proposal mechanism in the first iteration of Casper remains the same: It still uses Nakamoto PoW consensus where miners create the blocks. In order to finalize blocks, however, Casper’s PoS overlay takes control and has its validators vote on blocks trailing the PoW miners.</p><p name="53c2" id="53c2" class="graf graf--p graf-after--p">A key component of Casper’s PoS consensus are checkpoints. Casper assesses finality at 50 block increments called checkpoints and each 50 block segment is called an epoch. This process happens via validators sending a <em class="markup--em markup--p-em">Vote</em> message during each epoch.</p><p name="288f" id="288f" class="graf graf--p graf-after--p">It takes two epochs, i.e., two rounds of voting, in order to finalize a checkpoint one epoch ago. For example, when &gt; ⅔ of the validators, aka. “supermajority”, vote on a checkpoint, <em class="markup--em markup--p-em">c</em>, that checkpoint is said to be “justified”. Now in the next epoch, when a supermajority vote on that checkpoint, <em class="markup--em markup--p-em">c’</em>, two things happen: <em class="markup--em markup--p-em">c’</em> becomes justified and <em class="markup--em markup--p-em">c</em> is finalized. The epoch of <em class="markup--em markup--p-em">c</em> is referred to as the last finalized epoch (LFE).</p><p name="9982" id="9982" class="graf graf--p graf-after--p">In review, a block1 is said to finalize, <em class="markup--em markup--p-em">f</em>, after two conditions are met:</p><ol class="postList"><li name="6d7b" id="6d7b" class="graf graf--li graf-after--p">A supermajority (&gt;⅔) of validators <em class="markup--em markup--li-em">vote</em> on block1 in epoch1, thereby <em class="markup--em markup--li-em">justifying</em> block1.</li><li name="06a2" id="06a2" class="graf graf--li graf-after--li">A supermajority (&gt;⅔) of validators <em class="markup--em markup--li-em">vote</em> on block2 in epoch2, the direct child block to block1, thereby finalizing block1 during epoch2.</li></ol><p name="d2a8" id="d2a8" class="graf graf--p graf-after--li">In an ideal execution, a block is finalized in the following steps:</p><p name="207a" id="207a" class="graf graf--p graf-after--p">⅔ <em class="markup--em markup--p-em">Vote</em> block1 → <em class="markup--em markup--p-em">Justify</em> block1 → ⅔ <em class="markup--em markup--p-em">Vote</em> block2 → <em class="markup--em markup--p-em">Finalize</em> block1</p><ul class="postList"><li name="861c" id="861c" class="graf graf--li graf-after--p">Where block2 is direct child of block1</li></ul><figure name="b795" id="b795" class="graf graf--figure graf--layoutOutsetLeft graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 525px; max-height: 447px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 85.2%;"></div><img class="graf-image" data-image-id="1*744z4QUKEC5aGo8UT43m9Q.png" data-width="1012" data-height="862" src="https://cdn-images-1.medium.com/max/600/1*744z4QUKEC5aGo8UT43m9Q.png"></div><figcaption class="imageCaption">Here’s an illustration of Casper’s finality gadget logic. Each block represents a checkpoint. Lines represent 50 blocks (epoch) between each checkpoint. A block becomes the last finalized epoch (LFE) when its child block is justified.</figcaption></figure><p name="028d" id="028d" class="graf graf--p graf-after--figure">Validators are paid once a checkpoint is finalized. However, if there are two finalized checkpoints on two distinct forks at the same block height, thus violating safety, then slashing conditions come into play and at least ⅓ of the total security deposits staked will be slashed. Evidence for fault attribution when safety violations occur can be broadcasted as a transaction to the PoW miners. PoW miners then mine the block with the evidence transaction, and the validator(s) who submitted the evidence is rewarded a finder’s fee. When this happens, the guilty validator(s) who signed the conflicting blocks is slashed on both chains.</p><p name="1499" id="1499" class="graf graf--p graf-after--p">Now what happens if a miner were to execute a brute force PoW attack? Casper’s now finalized blockchain prevents PoW attackers, even with 51% or more of the hashpower, from rewriting history beyond the latest checkpoint. Thus, the Casper protocol provides safety. Unlike Casper the Friendly Ghost, because Casper the Friendly Finality Gadget is just an overlay on top of a separate proposal mechanism, Casper cannot guarantee liveness, as liveness depends on the proposal mechanism.</p><p name="67d2" id="67d2" class="graf graf--p graf-after--p">Validators are incentivized to converge on a canonical chain because they are penalized more over time as validators continue to vote on two divergent chains. With the formalization of <a href="https://docs.google.com/document/d/13_FSQ1Koq8uLvqTaSvZdb6OT2SpUZZq53vFiiDQj4qM/edit?usp=sharing" data-href="https://docs.google.com/document/d/13_FSQ1Koq8uLvqTaSvZdb6OT2SpUZZq53vFiiDQj4qM/edit?usp=sharing" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">‘slasher 2.0</a>’, validators are not just punished for double-voting but are penalized for voting on the <em class="markup--em markup--p-em">incorrect</em> fork. This does present a ‘discouragement’ predicament where validators end up opting out of voting from fear of getting slashed if there were a fork and they were unsure which one to choose.</p><p name="8609" id="8609" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Properties at a Glance</strong></p><ul class="postList"><li name="563d" id="563d" class="graf graf--li graf-after--p"><em class="markup--em markup--li-em">Finality</em>: <em class="markup--em markup--li-em">~20 minutes to finality. Finalized blocks once every 50 blocks (an epoch) makes the blockchain future-proof against brute force PoW mining attacks.</em></li><li name="ceff" id="ceff" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">Consensus safety.</em></li><li name="1cf7" id="1cf7" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">Provable liveness.</em></li><li name="344d" id="344d" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">Availability-prioritizing</em>.</li></ul><h4 name="d139" id="d139" class="graf graf--h4 graf-after--li"><strong class="markup--strong markup--h4-strong">Casper the Friendly Ghost</strong></h4><p name="a01c" id="a01c" class="graf graf--p graf-after--h4">Casper the Friendly Ghost (CTFG) is Vlad Zamfir’s correct-by-construction (CBC) consensus protocol tailored toward combatting an oligopolistic real world environment. CTFG is a PoS adaptation of the <a href="https://eprint.iacr.org/2013/881.pdf" data-href="https://eprint.iacr.org/2013/881.pdf" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Greedy Heaviest-Observed Subtree</a>, or GHOST protocol in PoW, for its fork choice rule. The guiding design principle behind Casper the Friendly Ghost is based on cryptoeconomics using formal methods aimed to achieve estimate safety. CTFG is a pure Proof-of-Stake concept, unlike Casper the Friendly Finality Gadget’s hybrid protocol detailed in the earlier section.</p><p name="e669" id="e669" class="graf graf--p graf--startsWithDoubleQuote graf-after--p"><em class="markup--em markup--p-em">“Casper was born as simply ‘the friendly ghost’, an adaptation of </em><a href="https://eprint.iacr.org/2013/881.pdf" data-href="https://eprint.iacr.org/2013/881.pdf" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><em class="markup--em markup--p-em">GHOST</em></a><em class="markup--em markup--p-em"> to Proof-of-Stake, complete with incentives that would make a cartel ‘friendly’ to non-cartel validators.”</em></p><p name="6e4e" id="6e4e" class="graf graf--p graf-after--p">— Vlad Zamfir, <a href="https://medium.com/@Vlad_Zamfir/the-history-of-casper-chapter-5-8652959cef58" data-href="https://medium.com/@Vlad_Zamfir/the-history-of-casper-chapter-5-8652959cef58" class="markup--anchor markup--p-anchor" target="_blank"><em class="markup--em markup--p-em">The History of Casper — Chapter 5</em></a></p><p name="25ac" id="25ac" class="graf graf--p graf-after--p">Similar to Proof-of-Work, Casper the Friendly Ghost (CTFG) trades off consistency for availability. In particular, blocks are not finalized; rather, they grow “safer” the deeper down the chain they get. Casper the Friendly Ghost is similar to CFFG in that the head of the chain is always progressing faster than the blocks are getting finalized.</p><p name="6f92" id="6f92" class="graf graf--p graf-after--p">The key differentiator in Casper’s PoS proposal mechanism from Tendermint’s is that instead of pseudo-randomly elected leaders, validators in the former can propose blocks based on the blocks that they’ve seen.</p><p name="0976" id="0976" class="graf graf--p graf-after--p">The unique functionality Casper offers is parameterizable safety thresholds. Similar to taking 6 confirmations in Bitcoin to determine economic finality, “estimate safety” in CTFG provides that one validator can have a different safety threshold than another validator. Casper’s design goal is to allow validators to pick their fault tolerance thresholds while the network maintains the low overhead of Proof-of-Work.</p><p name="38ae" id="38ae" class="graf graf--p graf-after--p">A core advantage that Casper has over Tendermint is in the number of validators that the network can accommodate at any given time. Since block creation in Tendermint requires finality at time of creation, block times should be short. And in order to achieve short block times, there needs to be a limit to the number of validators Tendermint PoS can accommodate. Since neither CTFG or CFFG require safety at time of block creation, the Ethereum network would be able to accommodate much more than, say, 100 validators.</p><p name="d967" id="d967" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Properties at a Glance</strong></p><ul class="postList"><li name="030f" id="030f" class="graf graf--li graf-after--p"><em class="markup--em markup--li-em">Available</em>. Casper’s nodes can have their blocks fork until they come to consensus.</li><li name="b0fb" id="b0fb" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">Asynchronously safe</em>.</li><li name="48ca" id="48ca" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">Live</em>. Casper’s decisions can be live in partial synchrony, but are not live in asynchrony.</li><li name="3d8e" id="3d8e" class="graf graf--li graf-after--li"><em class="markup--em markup--li-em">Cartel-resistant</em>. Casper’s entire premise is built upon resisting an oligopolistic attacker so that no colluding set of validators can overtake the protocol.</li><li name="5aa3" id="5aa3" class="graf graf--li graf-after--li graf--trailing"><em class="markup--em markup--li-em">Safety</em>. Depends on each validator’s estimate safety threshold.</li></ul></div></div></section><section name="e2c2" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="8092" id="8092" class="graf graf--h3 graf--leading">Future Work</h3><p name="0679" id="0679" class="graf graf--p graf-after--h3">Public blockchains running in production are a relatively nascent technology. The only security model in this paradigm that has so far shown to be incorruptible is Proof-of-Work. The design space in Proof-of-Stake is far more vast and the engineering tradeoffs far less understood as Proof-of-Stake is a research frontier and there just isn’t enough data. Needless to say, there is a lot of future work to be done to arrive at an optimal PoS consensus algorithm that adopts best practices once we know what those are.</p><p name="25e7" id="25e7" class="graf graf--p graf-after--p">One improvement in Tendermint could be a new proposal mechanism altogether, or one that compresses Tendermint’s multi-round voting process into a single round.</p><p name="4a56" id="4a56" class="graf graf--p graf-after--p">The second area of future work could be in leveraging more advanced cryptography to make the signatures on the block headers smaller. Because we’re building an ‘Internet of Blockchains’ through Cosmos, moving light client proofs from one blockchain to another is core of what we do. It would be hugely advantageous from that standpoint to use more advanced cryptography to decrease the size of the block headers by a factor of thirty or more. Currently, with 100 validators, Tendermint block headers are little less than 4 KB; they’re full of validator signatures. We can make the 100 signatures go from 3.2 KB to 64 bytes by using more advanced cryptography.</p><p name="418e" id="418e" class="graf graf--p graf-after--p graf--trailing">There are also ways of optimizing the peer-to-peer layer so that we can significantly decrease the amount of peer-to-peer traffic that’s needed to finalize a block. In future work, this would not only compress the amount of data that goes into the block header, but also decrease the amount of data sent to each peer. This would allow Tendermint to accommodate a much larger set of validators above the initial 100 validator threshold that the Cosmos network can have.</p></div></div></section><section name="b3f7" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="f3fe" id="f3fe" class="graf graf--p graf--leading"><em class="markup--em markup--p-em">The article was written by </em><a href="https://medium.com/u/199d4ef6bb67" data-href="https://medium.com/u/199d4ef6bb67" data-anchor-type="2" data-user-id="199d4ef6bb67" data-action-value="199d4ef6bb67" data-action="show-user-card" data-action-type="hover" class="markup--user markup--p-user" target="_blank"><em class="markup--em markup--p-em">Chjango Unchained</em></a><em class="markup--em markup--p-em">.</em></p><p name="7253" id="7253" class="graf graf--p graf-after--p graf--trailing"><em class="markup--em markup--p-em">Acknowledgements: Zaki Manian for the history lesson, </em><a href="http://sunnya97.com" data-href="http://sunnya97.com" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><em class="markup--em markup--p-em">Sunny Aggarwal</em></a><em class="markup--em markup--p-em"> &amp; Vlad Zamfir for Casper the Friendly Ghost insights, Virgil Griffith, Karl Floersch and Jon Choi for Finality Gadget review.</em></p></div></div></section>
</section>
<footer><p class="p-tags">Tagged in <a href="https://medium.com/tag/blockchain" class="p-tag">Blockchain</a>, <a href="https://medium.com/tag/tendermint" class="p-tag">Tendermint</a>, <a href="https://medium.com/tag/ethereum" class="p-tag">Ethereum</a>, <a href="https://medium.com/tag/cosmos" class="p-tag">Cosmos</a>, <a href="https://medium.com/tag/consensus" class="p-tag">Consensus</a></p><p>By <a href="https://medium.com/@tendermint" class="p-author h-card">Tendermint Team</a> on <a href="https://medium.com/p/6df154ad56ae"><time class="dt-published" datetime="2017-11-16T20:50:43.969Z">November 16, 2017</time></a>.</p><p><a href="https://medium.com/@tendermint/consensus-compare-casper-vs-tendermint-6df154ad56ae" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on April 23, 2018.</p></footer></article>

</body></html>