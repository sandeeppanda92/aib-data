<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Tendermint 0.10.0 Release</title><meta name="description" content="Tendermint 0.10.0 includes some major refactoring of the repositories, config, and logger. By Ethan Buchman"><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Tendermint 0.10.0 Release</h1>
</header>
<section data-field="subtitle" class="p-summary">
Tendermint 0.10.0 includes some major refactoring of the repositories, config, and logger. By Ethan Buchman
</section>
<section data-field="body" class="e-content">
<section name="6ee9" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="190b" id="190b" class="graf graf--h3 graf--leading graf--title">Tendermint 0.10.0 Release</h3><h4 name="476c" id="476c" class="graf graf--h4 graf-after--h3 graf--subtitle">Tendermint 0.10.0 includes some major refactoring of the repositories, config, and logger. By <a href="https://twitter.com/buchmanster" data-href="https://twitter.com/buchmanster" class="markup--anchor markup--h4-anchor" rel="noopener" target="_blank">Ethan Buchman</a></h4><blockquote name="f774" id="f774" class="graf graf--blockquote graf-after--h4">Credits to our <a href="https://tendermint.com/about" data-href="https://tendermint.com/about" class="markup--anchor markup--blockquote-anchor" rel="noopener" target="_blank">team</a>, and <a href="http://forum.tendermint.com:3000/" data-href="http://forum.tendermint.com:3000/" class="markup--anchor markup--blockquote-anchor" rel="noopener" target="_blank">community</a> for the hard work in making this release possible. Especially to <a href="https://twitter.com/akaliaev" data-href="https://twitter.com/akaliaev" class="markup--anchor markup--blockquote-anchor" rel="noopener" target="_blank">Anton Kaliaev (@melekes)</a> for his work on the new logger, and to <a href="https://medium.com/u/330d1b3768ba" data-href="https://medium.com/u/330d1b3768ba" data-anchor-type="2" data-user-id="330d1b3768ba" data-action-value="330d1b3768ba" data-action="show-user-card" data-action-type="hover" class="markup--user markup--blockquote-user" target="_blank">Ethan Frey</a> for fixing everything that broke during this massive refactor!</blockquote><p name="a602" id="a602" class="graf graf--p graf-after--blockquote">The main purpose of Tendermint 0.10.0 is to perform some major, long-overdue, cleanup. This includes merging repositories, introducing configuration structs, overhauling our logger, and cleaning up the JSON APIs.</p><p name="ce76" id="ce76" class="graf graf--p graf-after--p">Get the latest release at <a href="https://tendermint.com/download" data-href="https://tendermint.com/download" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">our downloads page</a>. See the <a href="https://github.com/tendermint/tendermint/blob/master/CHANGELOG.md#0100-june-2-2017" data-href="https://github.com/tendermint/tendermint/blob/master/CHANGELOG.md#0100-june-2-2017" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">v0.10.0 release notes</a> for more details.</p><p name="fff7" id="fff7" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Repository Merging</strong></p><p name="65a2" id="65a2" class="graf graf--p graf-after--p">When we initially introduced the ABCI in late 2015, we took apart the Tendermint codebase by moving many of the pieces into their own repositories. Most notable were the <code class="markup--code markup--p-code">go-p2p</code>, <code class="markup--code markup--p-code">go-rpc</code>, <code class="markup--code markup--p-code">go-crypto</code>, and <code class="markup--code markup--p-code">go-wire</code>, libraries, but there were also many more like <code class="markup--code markup--p-code">go-db</code>, <code class="markup--code markup--p-code">go-common</code>, <code class="markup--code markup--p-code">go-autofile</code>, and so on. Needless to say, it was painful to synchronize changes across all these repositories.</p><p name="2bc8" id="2bc8" class="graf graf--p graf-after--p">In v0.10.0, we merged <code class="markup--code markup--p-code">go-p2p</code> and <code class="markup--code markup--p-code">go-rpc</code> back into <code class="markup--code markup--p-code">tendermint</code>, in the <code class="markup--code markup--p-code">p2p</code> and <code class="markup--code markup--p-code">rpc/lib</code> subdirectories, respectively. We also merged most of the other <code class="markup--code markup--p-code">go-XXX</code> repositories into a new repository, called <code class="markup--code markup--p-code">tmlibs</code>. So now <code class="markup--code markup--p-code">go-common</code> is <code class="markup--code markup--p-code">tmlibs/common</code>, <code class="markup--code markup--p-code">go-db</code> is <code class="markup--code markup--p-code">tmlibs/db</code>, and so on.</p><p name="3c3a" id="3c3a" class="graf graf--p graf-after--p">The remaining independent libraries are now the following:</p><ul class="postList"><li name="75d1" id="75d1" class="graf graf--li graf-after--p"><code class="markup--code markup--li-code">tmlibs</code></li><li name="2422" id="2422" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">go-wire</code></li><li name="ebe9" id="ebe9" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">go-crypto</code></li><li name="1627" id="1627" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">abci</code></li><li name="6c0b" id="6c0b" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">tendermint</code></li></ul><p name="d54f" id="d54f" class="graf graf--p graf-after--li">The <code class="markup--code markup--p-code">go-merkle</code> repository is an exception. It contained two kinds of Merkle tree: a simple, static tree (eg. for hashing transactions), and a dynamic tree, the IAVL tree (eg. for storing state). The former has been moved to <code class="markup--code markup--p-code">tmlibs/merkle</code>. The latter can be found in <code class="markup--code markup--p-code">merkleeyes/iavl</code>. Note that <code class="markup--code markup--p-code"><a href="https://github.com/tendermint/merkleeyes" data-href="https://github.com/tendermint/merkleeyes" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">merkleeyes</a></code> is effectively an ABCI wrapper around the IAVL tree, so its a natural place for the library itself to live. It is also not used by Tendermint core, and is more a part of our application framework (which includes Basecoin) than a part of the core.</p><p name="cc21" id="cc21" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Config Structs</strong></p><p name="6d45" id="6d45" class="graf graf--p graf-after--p">Until now, configuration of a Tendermint node has been completely flat and somewhat adhoc. The config data was stored in a <code class="markup--code markup--p-code">map</code> and just passed around everywhere. In v0.10.0, we finally provided some structure, by defining an explicit <code class="markup--code markup--p-code">Config</code> struct, consisting of substructs for each important piece of Tendermint that needs to be configured. We also updated many functions, wherever suitable, to only pass in required arguments rather than an entire configuration.</p><p name="9ff4" id="9ff4" class="graf graf--p graf-after--p">The new configuration structs and their defaults can all be found in <a href="https://github.com/tendermint/tendermint/blob/master/config/config.go#L11" data-href="https://github.com/tendermint/tendermint/blob/master/config/config.go#L11" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">config/config.go</a>. We hope this makes the configuration options in Tendermint much more obvious, and simplifies configuring a node just the way you like it.</p><p name="23b2" id="23b2" class="graf graf--p graf-after--p">Some major differences to note are the <code class="markup--code markup--p-code">rpc</code> and <code class="markup--code markup--p-code">p2p</code> sub-configs. For instance, to specify seed nodes to connect with from the command line, you need to use the <code class="markup--code markup--p-code">p2p</code> prefix:</p><figure name="2be8" id="2be8" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/7ec2de430ad8ca39365e8625910ce361.js"></script></figure><p name="f7f2" id="f7f2" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">New Logger</strong></p><p name="afe2" id="afe2" class="graf graf--p graf-after--p">Until now, our logging implementation was quite lazy. Each package had its own global logger, and it was very difficult to configure it. This made it difficult to import Tendermint from other projects, and complicated important features like per-package log levels. So we completely overhauled the logger implementation. Loggers must now be explicitly passed where they are needed. We also now support per-package logging that can be specified in the <code class="markup--code markup--p-code">config.toml</code> or from the command line. We are so proud of our new logging implementation that we wrote a blog post just for it - <a href="https://gist.github.com/blog/abstracting-the-logger-interface-in-go" data-href="https://gist.github.com/blog/abstracting-the-logger-interface-in-go" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">check it out!</a></p><p name="292c" id="292c" class="graf graf--p graf-after--p">Please note that we have compressed what was once six log levels down to only three: <code class="markup--code markup--p-code">error</code>, <code class="markup--code markup--p-code">info</code>, and <code class="markup--code markup--p-code">debug</code>. This probably means you need to change your <code class="markup--code markup--p-code">config.toml</code> files to replace <code class="markup--code markup--p-code">notice</code> with <code class="markup--code markup--p-code">info</code>. Better yet, try out our new default setting, which takes advantage of the per-package log levels: <code class="markup--code markup--p-code">state:info,*:error</code>! It says to use <code class="markup--code markup--p-code">info</code> for the <code class="markup--code markup--p-code">state</code> package, and <code class="markup--code markup--p-code">error</code> for everything else. If you think you need more log levels, <a href="https://dave.cheney.net/2015/11/05/lets-talk-about-logging" data-href="https://dave.cheney.net/2015/11/05/lets-talk-about-logging" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">take it up with Dave Cheney</a>.</p><p name="b91a" id="b91a" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Cleaner APIs (no more go-wire!)</strong></p><p name="4555" id="4555" class="graf graf--p graf-after--p">Tendermint is a blockchain engine, which means strict determinism and efficient data formatting are paramount to success. For this reason, we defined our own serialization format — a simple binary representation of the basic data types, but with the additional ability to easily deserialize into interface types in Go. To achieve this, each implementation of an interface is given a type-byte and registered with the serialization library. Then when an interface type is being serialized, its simply prepended with the type-byte of the particular underlying implementation. This has been quite useful for things like transactions, keys, protocol messages, events, and so on.</p><p name="3ad6" id="3ad6" class="graf graf--p graf-after--p">Of course, as anyone who has used Tendermint probably knows, the problem with this was JSON serialization. For no good reason, we represented interfaces in JSON as an array, where the first element was the type byte and the second was the actual data. This caused no end of suffering for our users, and even ourselves. Well, I’m proud to say that we have eradicated all use of this obtuse JSON format from Tendermint! For instance, a public key that used to look like:</p><figure name="e060" id="e060" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/650abb1c8e7edd02cb03ea5332df1ef7.js"></script></figure><p name="bc02" id="bc02" class="graf graf--p graf-after--figure">Now looks like:</p><figure name="5723" id="5723" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/130647af55a96adf81da371040cfd189.js"></script></figure><p name="db3d" id="db3d" class="graf graf--p graf-after--figure">Isn’t that nice?</p><p name="9ff5" id="9ff5" class="graf graf--p graf-after--p">Furthermore, we’ve actually removed all type information from the RPC responses. We hope this makes parsing (and hence using) them much easier and more enjoyable!</p><p name="0920" id="0920" class="graf graf--p graf-after--p">If you have other ways you think we can improve our APIs, please <a href="https://github.com/tendermint/tendermint/issues/new" data-href="https://github.com/tendermint/tendermint/issues/new" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">let us know!</a></p><p name="0b0f" id="0b0f" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Up Next</strong></p><p name="ab99" id="ab99" class="graf graf--p graf-after--p">Phew! v0.10.0 marks some quite substantial cleanup — we’re thrilled with the result and we hope you are too. Tendermint should be much easier to use now, both for those using the RPC, and for those importing Tendermint as a library.</p><p name="7feb" id="7feb" class="graf graf--p graf-after--p">Next up for us are some important changes to ABCI to allow apps to decide what to do with validators who are offline or who misbehaved. This is critical for Proof-of-Stake protocols that use the security-deposits and “slashing”, and is the last big change we need to make to Tendermint to prepare for its use in Cosmos.</p><p name="f75a" id="f75a" class="graf graf--p graf-after--p graf--trailing">Cheers!</p></div></div></section><section name="cb07" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="37a7" id="37a7" class="graf graf--p graf--leading graf--trailing"><em class="markup--em markup--p-em">Originally published at </em><a href="https://gist.github.com/e6fd3416e9cc51196e242733450325c2" data-href="https://gist.github.com/e6fd3416e9cc51196e242733450325c2" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><em class="markup--em markup--p-em">gist.github.com</em></a><em class="markup--em markup--p-em">.</em></p></div></div></section>
</section>
<footer><p class="p-tags">Tagged in <a href="https://medium.com/tag/golang" class="p-tag">Golang</a>, <a href="https://medium.com/tag/tendermint" class="p-tag">Tendermint</a>, <a href="https://medium.com/tag/blockchain" class="p-tag">Blockchain</a>, <a href="https://medium.com/tag/consensus" class="p-tag">Consensus</a>, <a href="https://medium.com/tag/refactoring" class="p-tag">Refactoring</a></p><p>By <a href="https://medium.com/@nylira" class="p-author h-card">Peng Zhong</a> on <a href="https://medium.com/p/6c9e3dddc7db"><time class="dt-published" datetime="2017-06-05T07:00:00.000Z">June 5, 2017</time></a>.</p><p><a href="https://medium.com/@nylira/tendermint-0-10-0-released-major-refactoring-of-the-repositories-config-and-logger-6c9e3dddc7db" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on April 23, 2018.</p></footer></article>

</body></html>